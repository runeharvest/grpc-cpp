---
name: build (Ubuntu)

on:
  workflow_dispatch:
  release:
    types: [created]

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 120
    steps:
        - name: Build and extract artifact
          run: |
            make build-linux

        - name: Upload release asset
          uses: softprops/action-gh-release@v1
          if: github.event_name == 'release'
          with:
            files: grpc-protobuf-ubuntu.tar.gz
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

        - name: Upload artifact for workflow dispatch
          uses: actions/upload-artifact@v4
          if: github.event_name == 'workflow_dispatch'
          with:
            name: grpc-protobuf-ubuntu
            path: grpc-protobuf-ubuntu.tar.gz
